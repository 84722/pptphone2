<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <!-- 优化viewport设置，确保内容正确缩放 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>集团宣传册</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    /* 移除所有默认边距和内边距 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #f5f5f5;
      font-family: Arial, sans-serif;
      /* 确保body占满屏幕高度 */
      min-height: 100vh;
    }
    
    #viewer {
      width: 100%;
      /* 移除最大宽度限制，允许占满屏幕 */
      text-align: center;
      overflow-x: hidden; /* 防止横向滚动 */
    }
    
    .loading {
      color: #666;
      padding: 40px 20px;
      text-align: center;
    }
    
    .error {
      color: #dc3545;
      padding: 40px 20px;
      text-align: center;
    }
    
    canvas {
      /* 关键：让canvas宽度100%适应屏幕，高度自动按比例计算 */
      width: 100vw !important;
      height: auto !important;
      margin-bottom: 8px; /* 仅保留页与页之间的小间距 */
      background: #fff;
      /* 移除边框和阴影 */
      box-shadow: none;
      display: block; /* 防止canvas下方出现空隙 */
    }
    
    .page-info {
      color: #666;
      padding: 10px;
      text-align: center;
      background: #fff;
    }
  </style>
</head>
<body>
  <div id="viewer">
    <div class="loading">正在加载PDF文件，请稍候...</div>
  </div>
  <script>
    const url = "ttpdf.pdf"; // PDF文件路径
    const viewer = document.getElementById('viewer');

    if (typeof pdfjsLib === 'undefined') {
      viewer.innerHTML = '<div class="error">PDF查看器加载失败，请刷新页面重试</div>';
    } else {
      // 配置pdf.js工作器
      pdfjsLib.GlobalWorkerOptions.workerSrc = 
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

      // 加载并渲染PDF
      pdfjsLib.getDocument(url).promise
        .then(pdf => {
          viewer.innerHTML = '';
          
          // 显示总页数信息（可选，可删除）
          const pageInfo = document.createElement('div');
          pageInfo.className = 'page-info';
          pageInfo.textContent = `共 ${pdf.numPages} 页`;
          viewer.appendChild(pageInfo);
          
          // 自动计算适合屏幕的缩放比例
          const calculateScale = () => {
            // 获取屏幕宽度（不包括滚动条）
            const screenWidth = window.innerWidth;
            // 获取PDF第一页的原始宽度（72dpi下的宽度）
            return pdf.getPage(1).then(page => {
              const originalWidth = page.getViewport({ scale: 1 }).width;
              // 计算缩放比例使PDF宽度匹配屏幕宽度
              return screenWidth / originalWidth;
            });
          };
          
          calculateScale().then(scale => {
            // 逐页渲染
            for (let i = 1; i <= pdf.numPages; i++) {
              pdf.getPage(i)
                .then(page => {
                  const viewport = page.getViewport({ scale });
                  const canvas = document.createElement('canvas');
                  const context = canvas.getContext('2d');
                  
                  // 设置canvas尺寸
                  canvas.height = viewport.height;
                  canvas.width = viewport.width;
                  canvas.title = `第 ${i} 页`;
                  
                  // 添加到页面
                  viewer.appendChild(canvas);
                  
                  // 渲染页面
                  const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                  };
                  
                  return page.render(renderContext).promise;
                })
                .catch(err => {
                  console.error(`第${i}页渲染失败:`, err);
                  const errorEl = document.createElement('div');
                  errorEl.className = 'error';
                  errorEl.textContent = `第${i}页加载失败`;
                  viewer.appendChild(errorEl);
                });
            }
          });
        })
        .catch(err => {
          console.error('PDF文件加载失败:', err);
          let errorMessage = 'PDF文件加载失败，请检查网络连接或文件是否存在';
          
          if (err.name === 'MissingPDFException') {
            errorMessage = '未找到PDF文件，请确认文件路径是否正确';
          } else if (err.name === 'InvalidPDFException') {
            errorMessage = 'PDF文件损坏或格式不正确';
          } else if (err.message.includes('CORS')) {
            errorMessage = '跨域访问被阻止，请检查服务器配置';
          }
          
          viewer.innerHTML = `<div class="error">${errorMessage}</div>`;
        });
    }
  </script>
</body>
</html>
